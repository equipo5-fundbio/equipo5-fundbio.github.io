WindowManager:
    LoginWindow:
    MainWindow:
    TreatmentWindow:
    DataReadingWindow:
    DataHistoryWindow:

<ConnectItemSelect>:
    on_release: root.setter(check)

    CheckboxLeftWidget:
        id: check
        group: "check"

<MDTextField>:
    size_hint_x: 0.7
    width: 300
    font_size: 18
    pos_hint: {"center_x": 0.5}
    required: True
    helper_text_mode: 'persistent'
    helper_text: ""

<LoginWindow>:
    name: "login_window"

    BoxLayout:
        orientation:"vertical"

        MDLabel:
            text: "[font=Candara]¡Bienvenido![/font]"
            markup: True
            halign: "center"
            font_size: 40
            size_hint_y: None

        MDTabs:
            id: tabs
            background_color: 0,0,0,0
            indicator_color: app.theme_cls.primary_dark
    

<LoginTab>:

    BoxLayout:
        orientation:"vertical"
        spacing: 30

        MDTextField:
            id: user_login_dni
            hint_text: "Número de DNI"
            icon_right: "account"
            helper_text: "Este campo es obligatorio"

        MDTextField:
            id: user_login_password
            hint_text: "Contraseña"
            icon_right: "eye-off"
            password: True
            helper_text: "Este campo es obligatorio"
        
        MDFillRoundFlatButton:
            text: "[font=Candara]Ingresar[/font]"
            markup: True
            font_size: 16
            pos_hint: {"center_x": 0.5}
            md_bg_color: app.theme_cls.primary_dark
            on_release: 
                root.login()
                #app.root.current = "main_window"
                #app.root.get_screen("login_window").manager.transition.direction = "left"
        
        Widget:
            size_hint_y: None
            height: 150

<RegisterTab>:

    BoxLayout:
        orientation:"vertical"
        spacing: 20

        ScrollView:
            do_scroll_x: False
            do_scroll_y: True
            size_hint: (1, None)
            size: Window.width, Window.height

            GridLayout:
                cols:1
                spacing: 20
                padding: 70
                size_hint_y: None
                height: self.minimum_height

                Widget:
                    size_hint_y: None
                    height: 200

                MDTextField:
                    id: user_name
                    hint_text: "Nombres"
                    helper_text: "Este campo es obligatorio"
                
                MDTextField:
                    id: user_last_name
                    hint_text: "Apellidos"
                    helper_text: "Este campo es obligatorio"

                MDTextField:
                    id: user_dni
                    hint_text: "Número de DNI"
                    helper_text: "Este campo es obligatorio"

                MDTextField:
                    id: user_medic_dni
                    hint_text: "Número de DNI de su médico asignado"
                    helper_text: "Este campo es obligatorio"

                MDTextField:
                    id: user_email
                    hint_text: "Correo electrónico"
                    icon_right: "account"
                    helper_text: "Este campo es obligatorio"

                MDTextField:
                    id: user_password
                    hint_text: "Contraseña"
                    icon_right: "eye-off"
                    password: True
                    helper_text: "Este campo es obligatorio"
                
                MDTextField:
                    id: user_password_confirmation
                    hint_text: "Repetir Contraseña"
                    icon_right: "eye-off"
                    password: True
                    helper_text: "Este campo es obligatorio"

                MDTextField:
                    id: user_phone_number
                    hint_text: "Número de teléfono"
                    required: False

                MDTextField:
                    id: user_birth_date
                    hint_text: "Fecha de nacimiento"
                    required: False
                
                MDTextField:
                    id: user_sex
                    hint_text: "Sexo biológico"
                    required: False

                MDTextField:
                    id: user_birth_place
                    hint_text: "Lugar de nacimiento"
                    required: False
                
                MDTextField:
                    id: user_weight
                    hint_text: "Indique su peso"
                    required: False

                MDTextField:
                    id: user_height
                    hint_text: "Indique su altura"
                    required: False

                MDTextField:
                    id: user_health_center
                    hint_text: "Centro de Salud"
                    required: False
                
                MDTextField:
                    id: user_risser_index
                    hint_text: "Índice de Risser"
                    required: False
                
                MDTextField:
                    id: user_comorbilities
                    hint_text: "¿Posee alguna comorbilidad?"
                    required: False

        MDFillRoundFlatButton:
            text: "[font=Candara]Registrarse[/font]"
            markup: True
            font_size: 16
            pos_hint: {"center_x": 0.5}
            md_bg_color: app.theme_cls.primary_dark
            on_release: 
                root.register()
                #app.root.current = "main_window"
                #app.root.get_screen("login_window").manager.transition.direction = "left"
        
        Widget:
            size_hint_y: None
            height: 10

<RegisterMedicTab>:

    BoxLayout:
        orientation:"vertical"
        spacing: 20

        ScrollView:
            do_scroll_x: False
            do_scroll_y: True
            size_hint: (1, None)
            size: Window.width, Window.height

            GridLayout:
                cols:1
                spacing: 20
                padding: 70
                size_hint_y: None
                height: self.minimum_height

                Widget:
                    size_hint_y: None
                    height: 200

                MDTextField:
                    id: medic_name
                    hint_text: "Nombres"
                    helper_text: "Este campo es obligatorio"
                
                MDTextField:
                    id: medic_last_name
                    hint_text: "Apellidos"
                    helper_text: "Este campo es obligatorio"

                MDTextField:
                    id: medic_dni
                    hint_text: "Número de DNI"
                    helper_text: "Este campo es obligatorio"

                MDTextField:
                    id: medic_email
                    hint_text: "Correo electrónico"
                    icon_right: "account"
                    helper_text: "Este campo es obligatorio"

                MDTextField:
                    id: medic_password
                    hint_text: "Contraseña"
                    icon_right: "eye-off"
                    password: True
                    helper_text: "Este campo es obligatorio"
                
                MDTextField:
                    id: medic_password_confirmation
                    hint_text: "Repetir Contraseña"
                    icon_right: "eye-off"
                    password: True
                    helper_text: "Este campo es obligatorio"

                MDTextField:
                    id: medic_phone_number
                    hint_text: "Número de teléfono"
                    required: False

        MDFillRoundFlatButton:
            text: "[font=Candara]Registrarse[/font]"
            markup: True
            font_size: 16
            pos_hint: {"center_x": 0.5}
            md_bg_color: app.theme_cls.primary_dark
            on_release: 
                root.register_medic()
                #app.root.current = "main_window"
                #app.root.get_screen("login_window").manager.transition.direction = "left"
        
        Widget:
            size_hint_y: None
            height: 10

<MainWindow>:
    name: "main_window"

    BoxLayout:
        id: main_box
        orientation:"vertical"

        MDToolbar:
            id: main_toolbar
            title: "[font=Candara]Inicio[/font]"
            markup: True
            #left_action_items: [["menu", lambda x: app.callback()]]

        MDBottomNavigation:
            id: main_nav

            MDBottomNavigationItem:
                name: 'main_screen'
                text: "Inicio"
                markup: True
                icon: "shield-home-outline"
                on_tab_release: main_toolbar.title = "[font=Candara]Inicio[/font]"

                BoxLayout:
                    orientation: "vertical"
                    spacing: 50
                    padding: 10
                
                    MDFillRoundFlatButton:
                        text: "[font=Candara]Iniciar lectura de presión[/font]"
                        markup: True
                        font_size: 16
                        pos_hint: {"center_x": 0.5}
                        md_bg_color: app.theme_cls.primary_dark
                        on_release: 
                            app.root.current = "data_reading_window"
                            app.root.get_screen("login_window").manager.transition.direction = "left"
                    
                    MDFillRoundFlatButton:
                        text: "[font=Candara]Iniciar tratamiento[/font]"
                        markup: True
                        font_size: 16
                        pos_hint: {"center_x": 0.5}
                        md_bg_color: app.theme_cls.primary_dark
                        on_release: 
                            app.root.current = "treatment_window"
                            app.root.get_screen("login_window").manager.transition.direction = "left"
                    
                    MDFillRoundFlatButton:
                        text: "[font=Candara]Ver historial de datos[/font]"
                        markup: True
                        font_size: 16
                        pos_hint: {"center_x": 0.5}
                        md_bg_color: app.theme_cls.primary_dark
                        on_release: 
                            root.select_sensor_graphs()
                            #app.root.current = "data_history_window"
                            #app.root.get_screen("login_window").manager.transition.direction = "left"
                    
                    Widget:
                        size_hint_y: None
                        height: 150
            
            MDBottomNavigationItem:
                name: 'notif_screen'
                text: "Notificaciones"
                markup: True
                icon: "bell-ring"
                on_tab_release: main_toolbar.title = "[font=Candara]Notificaciones[/font]"

                ScrollView:
                    do_scroll_x: False
                    do_scroll_y: True
                    size_hint: (1, None)
                    size: Window.width, Window.height

                    GridLayout:
                        id: not_grid
                        cols: 1
                        spacing: 20
                        padding: 10
                        size_hint_y: None
                        height: self.minimum_height

                        Widget:
                            size_hint_y: None
                            height: 150

                        MDCard:
                            orientation: "vertical"
                            padding: "8dp"
                            size_hint: None, None
                            size: Window.width-20, 100
                            elevation: 15
                        
                            MDLabel:
                                id: first_not_date
                                text: "Hoy"
                                theme_text_color: "Secondary"
                                adaptive_height: True

                            MDSeparator:
                                height: "1dp"

                            MDLabel:
                                id: first_not_label
                                text: "Dr. Luis Eduardo Beingolea Cruz solicita una cita médica presencial"
                        
                        MDCard:
                            orientation: "vertical"
                            padding: "8dp"
                            size_hint: None, None
                            size: Window.width-20, 100
                            elevation: 15
                        
                            MDLabel:
                                id: second_not_date
                                text: "Domingo 24 de octubre"
                                theme_text_color: "Secondary"
                                adaptive_height: True

                            MDSeparator:
                                height: "1dp"

                            MDLabel:
                                id: second_not_label
                                text: "Dr. Luis Eduardo Beingolea Cruz:\nRetírese la órtesis y vuelva en 5 horas"
                            
                        MDCard:
                            orientation: "vertical"
                            padding: "8dp"
                            size_hint: None, None
                            size: Window.width-20, 100
                            elevation: 15
                        
                            MDLabel:
                                id: third_not_date
                                text: "Miércoles 20 de octubre"
                                theme_text_color: "Secondary"
                                adaptive_height: True

                            MDSeparator:
                                height: "1dp"

                            MDLabel:
                                id: third_not_label
                                text: "Dr. Luis Eduardo Beingolea Cruz:\nRealice nuevamente el 'test de lectura de datos'"
            
            MDBottomNavigationItem:
                id: profile
                name: 'profile_screen'
                text: "Perfil"
                markup: True
                icon: "account-circle"
                on_tab_release: main_toolbar.title = "[font=Candara]Perfil[/font]"
            
                BoxLayout:
                    id: profile_box
                    orientation:"vertical"
                    spacing: 20

                    ScrollView:
                        id: profile_scroll
                        do_scroll_x: False
                        do_scroll_y: True
                        size_hint: (1, None)
                        size: Window.width, Window.height

                        GridLayout:
                            id: profile_grid
                            cols:1
                            spacing: 20
                            padding: 70
                            size_hint_y: None
                            height: self.minimum_height

                            Widget:
                                size_hint_y: None
                                height: 200
                            
                            MDLabel:
                                id: welcome_label
                                text: "[font=Candara]Hola,[/font]"
                                markup: True
                                size_hint_y: None
                                font_size: 35
                            
                            MDLabel:
                                text: "[font=Candara]Aquí podrás ver y editar tu información personal[/font]"
                                markup: True
                            
                            Widget:
                                size_hint_y: None
                                height: 5

                            MDTextField:
                                id: user_name
                                hint_text: ""
                                helper_text: "Nombres"
                                icon_right: "pencil-outline"
                                required: False
                            
                            MDTextField:
                                id: user_last_name
                                hint_text: ""
                                helper_text: "Apellidos"
                                icon_right: "pencil-outline"
                                required: False

                            MDTextField:
                                id: user_email
                                hint_text: ""
                                helper_text: "Correo electrónico"
                                icon_right: "pencil-outline"
                                required: False

                            MDTextField:
                                id: user_phone_number
                                hint_text: ""
                                helper_text: "Número de teléfono"
                                icon_right: "pencil-outline"
                                required: False

                            MDTextField:
                                id: user_birth_date
                                hint_text: ""
                                helper_text: "Fecha de nacimiento"
                                icon_right: "pencil-outline"
                                required: False
                            
                            MDTextField:
                                id: user_sex
                                hint_text: ""
                                helper_text: "Sexo biológico"
                                icon_right: "pencil-outline"
                                required: False

                            MDTextField:
                                id: user_birth_place
                                hint_text: ""
                                helper_text: "Lugar de nacimiento"
                                icon_right: "pencil-outline"
                                required: False
                            
                            MDTextField:
                                id: user_weight
                                hint_text: ""
                                helper_text: "Indique su peso"
                                icon_right: "pencil-outline"
                                required: False

                            MDTextField:
                                id: user_height
                                hint_text: ""
                                helper_text: "Indique su altura"
                                icon_right: "pencil-outline"
                                required: False

                            MDTextField:
                                id: user_health_center
                                hint_text: ""
                                helper_text: "Centro de Salud"
                                icon_right: "pencil-outline"
                                required: False
                            
                            MDTextField:
                                id: user_risser_index
                                hint_text: ""
                                helper_text: "Índice de Risser"
                                icon_right: "pencil-outline"
                                required: False
                            
                            MDTextField:
                                id: user_comorbilities
                                hint_text: ""
                                helper_text: "¿Posee alguna comorbilidad?"
                                icon_right: "pencil-outline"
                                required: False
                            
                            MDCard:
                                orientation: "vertical"
                                padding: "8dp"
                                elevation: 10
                                size_hint: None, None
                                size: "225dp", "250dp"
                                pos_hint: {"center_x": .5, "center_y": .5}

                                MDLabel:
                                    text: "Datos del médico tratante"
                                    theme_text_color: "Secondary"
                                    adaptive_height: True

                                MDSeparator:
                                    height: "1dp"

                                MDLabel:
                                    id: medic_name_label
                                    text: "[b]Nombre Completo:[/b]\nDr. Luis Eduardo Beingolea Cruz"
                                    markup: True
                                MDLabel:
                                    id: medic_email_label
                                    text: "[b]Correo electrónico:[/b]\nleduardo.cruz@gmail.com"
                                    markup: True
                                
                                MDLabel:
                                    id: medic_phone_label
                                    text: "[b]Teléfono celular:[/b]\n933785293"
                                    markup: True

                    MDFillRoundFlatButton:
                        text: "[font=Candara]Guardar[/font]"
                        markup: True
                        font_size: 16
                        pos_hint: {"center_x": 0.5}
                        md_bg_color: app.theme_cls.primary_dark
                        padding_y: 50
                        on_release: root.update_data()
                    
                    Widget:
                        size_hint_y: None
                        height: 5

<TreatmentWindow>:
    name: "treatment_window"

    MDBoxLayout:
        orientation:"vertical"

        MDToolbar:
            id: treatment_toolbar
            title: "[font=Candara]Tratamiento[/font]"
            markup: True
            left_action_items: [["arrow-left", lambda x: app.return_main()]]
        
        BoxLayout:
            orientation: "vertical"
            padding: 20
            spacing: 5

            MDLabel:
                size_hint_y: None
                text: "[font=Candara]Al presionar 'Iniciar tratamiento' se ejercerá presión según lo indicado por su médico tratante[/font]"
                halign: "center"
                markup: True

            MDFillRoundFlatButton:
                id: start_treatment_button
                text: "[font=Candara]Iniciar Tratamiento[/font]"
                markup: True
                disabled: True
                font_size: 16
                pos_hint: {"center_x": 0.5}
                md_bg_color: app.theme_cls.primary_dark
                padding_y: 1
                on_press: root.start_treatment()
            
            MDTextField:
                id: p1_text_field
                hint_text: "... kPa"
                helper_text: "Presión ejercida en punto 1"
                required: False
                disabled: True

            MDTextField:
                id: p2_text_field
                hint_text: "... kPa"
                helper_text: "Presión ejercida en punto 2"
                required: False
                disabled: True
            
            MDTextField:
                id: p3_text_field
                hint_text: "... kPa"
                helper_text: "Presión ejercida en punto 3"
                required: False
                disabled: True

            MDFillRoundFlatButton:
                id: t_save_button
                text: "[font=Candara]Guardar[/font]"
                markup: True
                disabled: True
                font_size: 16
                pos_hint: {"center_x": 0.5}
                md_bg_color: app.theme_cls.primary_dark
                padding_y: 50
                on_release: root.save_pressure_data()

            Widget:
                size_hint_y: None
                height: 150
                


        


<DataReadingWindow>:
    name: "data_reading_window"

    MDBoxLayout:
        orientation:"vertical"

        MDToolbar:
            id: data_reading_toolbar
            title: "[font=Candara]Test de lectura de datos[/font]"
            markup: True
            left_action_items: [["arrow-left", lambda x: app.return_main()]]
        
        BoxLayout:
            orientation: "vertical"
            padding: 20
            spacing: 10

            MDLabel:
                size_hint_y: None
                text: "[font=Candara]Por favor, colóquese e inicie el test de pie en una posición erguida y sin agachar la cabeza.\nPermanezca en tal posición por 3 minutos[/font]"
                halign: "center"
                markup: True

            MDFillRoundFlatButton:
                id: establish_connection_button
                text: "[font=Candara]Establecer conexión[/font]"
                markup: True
                font_size: 16
                pos_hint: {"center_x": 0.5}
                md_bg_color: app.theme_cls.primary_dark
                padding_y: 50
                on_press: root.start_connection()

            MDFillRoundFlatButton:
                id: start_test_button
                text: "[font=Candara]Iniciar Test[/font]"
                disabled: True
                markup: True
                font_size: 16
                pos_hint: {"center_x": 0.5}
                md_bg_color: app.theme_cls.primary_dark
                padding_y: 50
                on_press: root.start_test()

            Widget:
                size_hint_y: None
                height: 200

<DataHistoryWindow>:
    name: "data_history_window"

    MDBoxLayout:
        orientation:"vertical"
        spacing: 20

        MDToolbar:
            id: treatment_toolbar
            title: "[font=Candara]Historial de datos[/font]"
            markup: True
            left_action_items: [["arrow-left", lambda x: app.return_main()]]
        
        FloatLayout:
            
            BoxLayout:
                id: graphics_box
                size_hint_y: .7
                pos_hint: {"center_x": 0.5,"top":1}

            BoxLayout:
                orientation: "vertical"
                size_hint_y: .3

                MDLabel:
                    id: data_history_label
                    text: "Datos de los últimos 30 días"
                    halign: "center"
                    size_hint_y: None
        
